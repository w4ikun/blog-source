name: Test Deploy

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      
    - name: Setup Node
      uses: actions/setup-node@v3
      with:
        node-version: '16'
        cache: 'npm'  # æ·»åŠ ç¼“å­˜ï¼ŒåŠ é€Ÿåç»­è¿è¡Œ
        
    - name: Install dependencies
      run: |
        echo "å¼€å§‹å®‰è£…ä¾èµ–..."
        npm ci  # ä½¿ç”¨ npm ci è€Œä¸æ˜¯ npm installï¼Œæ›´å¯é 
        echo "å®‰è£…å®Œæˆï¼"
        
    - name: Build Hexo site
      run: |
        echo "=== Hexo ç‰ˆæœ¬ ==="
        npx hexo version
        echo ""
        echo "=== æ¸…ç† ==="
        npx hexo clean
        echo ""
        echo "=== ç”Ÿæˆé™æ€æ–‡ä»¶ ==="
        npx hexo generate
        echo ""
        echo "=== ç”Ÿæˆçš„æ–‡ä»¶ ==="
        ls -la public/
        echo ""
        echo "=== æ–‡ä»¶æ•°é‡ ==="
        find public/ -type f | wc -l
        
    - name: Show build info
      run: |
        echo "ğŸ‰ Build completed!"
        echo "ğŸ“ æŸ¥çœ‹ public/ ç›®å½•çš„å†…å®¹"
        echo "ğŸ“Š æ€»æ–‡ä»¶æ•°: $(find public/ -type f | wc -l)"
        echo "ğŸ”— Actions URL: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"